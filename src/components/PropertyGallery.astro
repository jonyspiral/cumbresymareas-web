---
// PropertyGallery.astro
import 'photoswipe/style.css';

interface Props {
  heroImage: any;
  galeriaSecundaria: any[];
}

const { heroImage, galeriaSecundaria } = Astro.props;
---

<div class="gallery-grid" id="property-gallery">
  <a
    href={heroImage.src}
    data-pswp-width={heroImage.width || 1200}
    data-pswp-height={heroImage.height || 800}
    class="photo-main"
    target="_blank"
  >
    <img src={heroImage.src} alt="Vista Principal" />
    <div class="zoom-badge">Ampliar Galer√≠a üîç</div>
  </a>

  <div class="photo-thumbs">
    {galeriaSecundaria.slice(0, 3).map((foto, index) => (
      <a
        href={foto.src}
        data-pswp-width={foto.width || 1200}
        data-pswp-height={foto.height || 800}
        class="thumb-link"
        target="_blank"
      >
        <img src={foto.src} alt="Detalle propiedad" loading="lazy" />
        {index === 2 && galeriaSecundaria.length > 3 && (
          <div class="more-overlay">
            <span>+{galeriaSecundaria.length - 3} fotos</span>
          </div>
        )}
      </a>
    ))}

    {galeriaSecundaria.slice(3).map((foto) => (
      <a
        href={foto.src}
        data-pswp-width={foto.width || 1200}
        data-pswp-height={foto.height || 800}
        class="hidden"
      ></a>
    ))}
  </div>
</div>

<style>
  .gallery-grid {
    display: grid;
    grid-template-columns: 2.5fr 1fr; /* Proporci√≥n para que la hero domine */
    gap: 12px;
    margin: 30px 0;
    width: 100%;
  }

  .photo-main {
    position: relative;
    height: 512px;
    border-radius: 12px;
    overflow: hidden;
    display: block;
  }

  .photo-main img, .thumb-link img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .photo-main:hover img, .thumb-link:hover img {
    transform: scale(1.03);
  }

  .photo-thumbs {
    display: grid;
    grid-template-rows: repeat(3, 1fr);
    gap: 12px;
  }

  .thumb-link {
    position: relative;
    height: 162px;
    border-radius: 8px;
    overflow: hidden;
    display: block;
  }

  .zoom-badge {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    padding: 8px 16px;
    border-radius: 30px;
    font-size: 0.85rem;
    backdrop-filter: blur(4px);
    font-family: 'Inter', sans-serif;
  }

  .more-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
  }

  .hidden { display: none; }

  @media (max-width: 800px) {
    .gallery-grid { grid-template-columns: 1fr; }
    .photo-main { height: 320px; }
    .photo-thumbs {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: none;
      height: 100px;
    }
    .thumb-link { height: 100%; }
  }
</style>

<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  const lightbox = new PhotoSwipeLightbox({
    gallery: '#property-gallery',
    children: 'a',
    pswpModule: () => import('photoswipe')
  });
  lightbox.init();
</script>